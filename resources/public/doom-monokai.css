/* CONTRACT: doom-monokai.css
   Purpose:
   - Org HTML export provides structure.
   - CSS provides chrome, typography, and pane presentation.
   - JS compositor injects minimal chrome + modeline content.
   Non-goals:
   - Do not depend on Org's default inline CSS.
   - Avoid duplicate/overlapping selectors.
*/

/* ----------------------------------------------------------------------------
   Fonts
---------------------------------------------------------------------------- */

@font-face {
  font-family: "MonoLisaSkav";
  src: url("fonts/MonoLisaMonoLisaSkav-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "MonoLisaSkav";
  src: url("fonts/MonoLisaMonoLisaSkav-RegularItalic.ttf") format("truetype");
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

/* ----------------------------------------------------------------------------
   Theme + layout tokens (no magic numbers downstream)
---------------------------------------------------------------------------- */

:root {
  /* Core colors */
  --bg: #1c1e1f;
  --block: #202020;
  --line: #2d2e2e;

  --fg: #e8e3d6;
  --pane-fg: #f2efe6;

  --muted: #b7b1a1;
  --dim: #807a6a;

  --green:  #a6e22e;
  --cyan:   #66d9ef;
  --orange: #fd971f;
  --pink:   #f92672;
  --yellow: #e6b450;

  /* Typography */
  --font: "MonoLisaSkav", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "DejaVu Sans Mono", monospace;

  --text-letter-spacing: 0.2px;
  --text-line-height: 1.45;
  --text-rendering: optimizeLegibility;

  /* Responsive chrome sizing */
  --topbar-h-min: 44px;
--topbar-h-vh: 5.2vh;
--topbar-h-max: 64px;
  --topbar-h: clamp(var(--topbar-h-min), var(--topbar-h-vh), var(--topbar-h-max));

  --workbar-h-min: 40px;
  --workbar-h-max: 52px;
  --workbar-h-vh: 5.5vh;
  --workbar-h: clamp(var(--workbar-h-min), var(--workbar-h-vh), var(--workbar-h-max));

  /* Spacing scale */
  --padx: 1.9rem;
  --content-gap-top: 22px;        /* can also be clamped if you want */
  --section-gap: 26px;

  /* Chrome background fields */
  --titlebar-field: #141517;
  --titlebar-seg-right: #181a1c;

  /* Header hue knobs */
  --hdr-green: #a6e22e;
  --hdr-amber: #fd971f;
  --hdr-ice:   #a8d8ff;
  --hdr-white: #e8e3d6;

  --hdr-color: var(--hdr-amber);
  --hdr-weight: 600;

  /* Powerline geometry ratios (all derived below) */
  --wedge-ratio: 0.50;            /* wedge width relative to bar height */
  --chev-size-ratio: 0.32;        /* chevron box relative to bar height */
  --chev-stroke-ratio: 0.07;      /* stroke relative to bar height */
  --chev-offset-ratio: 0.34;      /* how far chevron sits into wedge */

  /* Derived geometry (no hard pixels in chrome) */
  --wedge-w: calc(var(--topbar-h) * var(--wedge-ratio));
  --wedge-half: calc(var(--topbar-h) / 2);

  --chev-size: calc(var(--topbar-h) * var(--chev-size-ratio));
  --chev-stroke: max(2px, calc(var(--topbar-h) * var(--chev-stroke-ratio)));
  --chev-right: calc(var(--wedge-w) * var(--chev-offset-ratio));

  /* Chrome typography */
  --title-font-size: clamp(18px, 2.2vh, 22px);
  --tabs-font-size: clamp(13px, 1.9vh, 15px);

  /* Segment padding */
  --seg-pad-x: clamp(14px, 1.6vw, 20px);

  /* List + content spacing */
  --para-margin-y: 12px;
  --list-margin-y: 12px;
  --list-margin-bottom: 18px;
  --list-item-gap: 6px;
  --list-bullet-indent: 18px;

  /* Pane typography */
  --code-font-size: 14px;
  --code-line-height: 1.5;
  --block-margin-bottom: 26px;
  --block-margin-top: 12px;
  --block-pad-y: 14px;
  --block-pad-x: 16px;

  /* Media */
  --media-margin-y: 16px;
  --media-pad: 6px;
  --video-max-h: 50vh;

  /* Modeline */
  --modeline-h: var(--workbar-h);
  --modeline-font-size: var(--tabs-font-size);
  --modeline-gap: 10px;

  /* Selection */
  --selection-bg: rgba(166, 226, 46, 0.22);
}

/* Prevent initial hue flash */
html[data-hdr-hue="amber"] { --hdr-color: var(--hdr-amber); }
html[data-hdr-hue="green"] { --hdr-color: var(--hdr-green); }
html[data-hdr-hue="ice"]   { --hdr-color: var(--hdr-ice); }
html[data-hdr-hue="white"] { --hdr-color: var(--hdr-white); }

/* ----------------------------------------------------------------------------
   Base layout + accessibility
---------------------------------------------------------------------------- */

* {
  box-sizing: border-box;
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-tap-highlight-color: transparent;
}

*::-webkit-scrollbar {
  width: 0 !important;
  height: 0 !important;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg) !important;
  color: var(--fg) !important;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;

  font-family: var(--font);
  font-variant-ligatures: none;
  text-rendering: var(--text-rendering);
  letter-spacing: var(--text-letter-spacing);
  line-height: var(--text-line-height);
  padding-top: calc(var(--topbar-h) + var(--workbar-h));
  padding-left: var(--padx);
  padding-right: var(--padx);
}

@supports (padding: env(safe-area-inset-left)) {
  body {
    padding-left: calc(var(--padx) + env(safe-area-inset-left));
    padding-right: calc(var(--padx) + env(safe-area-inset-right));
    padding-top: calc(
      var(--topbar-h) + var(--workbar-h) + var(--content-gap-top) + env(safe-area-inset-top)
    );
  }
}

::selection {
  background: var(--selection-bg);
}

/* Org TOC is not part of Consol surface */
#table-of-contents,
.toc,
.org-ul.toc {
  display: none !important;
}

/* ----------------------------------------------------------------------------
   Links
---------------------------------------------------------------------------- */

a {
  color: rgba(102, 217, 239, 0.85);
  text-decoration: none;
}

a:hover {
  color: var(--green);
}

/* ----------------------------------------------------------------------------
   CHROME: TITLEBAR
   Goals:
   - Left segment + dim wedge always present.
   - Thin chevron outline blinks ON TOP of dim wedge.
   - Right segment + dim grey wedge always present.
   - Everything scales from --topbar-h.
---------------------------------------------------------------------------- */

h1.title{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 200;

  margin: 0;
  padding: 0;

  display: flex;
  justify-content: space-between;
  align-items: stretch;

  height: var(--topbar-h);

  background: var(--titlebar-field);
  border-bottom: 1px solid var(--line);

  font-size: var(--title-font-size);
  font-weight: var(--hdr-weight);
  text-transform: lowercase;

  color: var(--fg);
}

h1.title .title-left-group{
  display: inline-flex;
  align-items: stretch;
}

h1.title .title-left,
h1.title .title-right{
  position: relative;
  display: inline-flex;
  align-items: center;

  height: 100%;
  padding: 0 var(--seg-pad-x);
}

/* LEFT segment */
h1.title .title-left{
  background: color-mix(in srgb, var(--hdr-color) 18%, #000);
  color: var(--hdr-color);
  border-left: max(2px, calc(var(--topbar-h) * 0.06)) solid var(--hdr-color);
}

h1.title .title-text{
  white-space: nowrap;
}

/* Dim filled wedge (always visible) */
h1.title .title-left::after{
  content: "";
  position: absolute;
  top: 0;
  right: calc(var(--wedge-w) * -1);

  width: 0;
  height: 0;

  border-top: var(--wedge-half) solid transparent;
  border-bottom: var(--wedge-half) solid transparent;
  border-left: var(--wedge-w) solid color-mix(in srgb, var(--hdr-color) 18%, #000);

  z-index: 1;
}

/* Thin chevron (blinks) drawn on top of the wedge */
h1.title .title-left::before{
  content: "";
  position: absolute;

  top: 50%;
  right: calc(var(--wedge-w) * -1 + var(--chev-right));

  width: var(--chev-size);
  height: var(--chev-size);

  border-top: var(--chev-stroke) solid var(--hdr-color);
  border-right: var(--chev-stroke) solid var(--hdr-color);

  transform: translateY(-50%) rotate(45deg);

  z-index: 2;
  animation: consol-chevron-blink 1.1s step-end infinite;
}

@keyframes consol-chevron-blink{
  0%, 45% { opacity: 1; }
  46%, 100% { opacity: 0; }
}

/* RIGHT segment */
h1.title .title-right{
  background: var(--titlebar-seg-right);
  color: color-mix(in srgb, var(--hdr-color) 70%, var(--fg));
}

/* Dim grey wedge (always visible) */
h1.title .title-right::before{
  content: "";
  position: absolute;
  top: 0;
  left: calc(var(--wedge-w) * -1);

  width: 0;
  height: 0;

  border-top: var(--wedge-half) solid transparent;
  border-bottom: var(--wedge-half) solid transparent;
  border-right: var(--wedge-w) solid var(--titlebar-seg-right);
}

/* ----------------------------------------------------------------------------
   CHROME: Workspace strip (tabs)
   Supports:
   - old pages: #content > h1.title + p
   - injected:  #content > p.slab-tabs
---------------------------------------------------------------------------- */

#content > h1.title + p,
#content > p.slab-tabs {
  position: fixed;
  top: var(--topbar-h);
  left: 0;
  right: 0;
  z-index: 190;

  margin: 0;
  height: var(--workbar-h);

  display: flex;
  align-items: center;

  padding: 0 calc(var(--padx) + env(safe-area-inset-left));

  background: var(--titlebar-seg-right);
  border-bottom: 1px solid var(--line);

  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;

  font-size: var(--tabs-font-size);
}

#content > :first-child{
  margin-top: 0 !important;
}

#content > h1.title + p a,
#content > p.slab-tabs a {
  display: inline-block;
  padding: calc(var(--workbar-h) * 0.12) calc(var(--workbar-h) * 0.22);
  margin-right: calc(var(--workbar-h) * 0.14);

  color: var(--muted);
  border-bottom: max(2px, calc(var(--workbar-h) * 0.04)) solid transparent;
}

#content > h1.title + p a:hover,
#content > h1.title + p a.active,
#content > p.slab-tabs a:hover,
#content > p.slab-tabs a.active {
  color: var(--fg);
  border-bottom-color: var(--orange);
}

/* ----------------------------------------------------------------------------
   Content structure
---------------------------------------------------------------------------- */

#content {
    flex: 1 1 auto;
    padding-top: var(--content-gap-top);
}

/* Section headers */
h2 {
  margin: var(--section-gap) 0 10px 0;
  padding: 10px 12px;

  background: rgba(15, 18, 22, 0.35);
  border: 1px solid var(--line);
  border-left: 4px solid var(--orange);

  color: var(--orange);
  font-size: 18px;
  font-weight: 800;
  letter-spacing: 0.09em;
  text-transform: uppercase;
}

/* Paragraphs */
p {
  margin: var(--para-margin-y) 0;
  color: var(--fg);
}

/* Lists */
ul {
  list-style: none;
  padding-left: 0;
  margin: var(--list-margin-y) 0 var(--list-margin-bottom) 0;
}

ul li {
  position: relative;
  padding-left: var(--list-bullet-indent);
  margin: var(--list-item-gap) 0;
  color: var(--fg);
}

ul li::before {
  content: "â€¢";
  position: absolute;
  left: 0;
  top: 0;
  color: var(--yellow);
  font-weight: 700;
}

/* ----------------------------------------------------------------------------
   Panes / examples / preformatted
---------------------------------------------------------------------------- */

.example,
pre,
pre.example {
  background: var(--block);
  border: 1px solid var(--line);
  margin: var(--block-margin-top) 0 var(--block-margin-bottom) 0;

  overflow: hidden;

  font-family: var(--font);
  font-size: var(--code-font-size);
  line-height: var(--code-line-height);
  color: var(--pane-fg);
}

.example {
  padding: var(--block-pad-y) var(--block-pad-x);
}

pre.example {
  padding: 0;
}

/* Pane accent bars */
.example.pane-kv,    pre.example.pane-kv    { box-shadow: inset 0 2px 0 rgba(249, 38, 114, 0.55); }
.example.pane-art,   pre.example.pane-art   { box-shadow: inset 0 2px 0 rgba(102, 217, 239, 0.45); }
.example.pane-warn,  pre.example.pane-warn  { box-shadow: inset 0 2px 0 rgba(253, 151, 31, 0.60); }
.example.pane-media, pre.example.pane-media { box-shadow: inset 0 2px 0 rgba(230, 180, 80, 0.60); }
.example.pane-note,  pre.example.pane-note  { box-shadow: inset 0 2px 0 rgba(128, 122, 106, 0.55); }

pre.example .kv {
  display: grid;
  grid-template-columns: 112px 1fr;
  gap: 8px 14px;
  padding: 14px 16px;
}

pre.example .row { display: contents; }

pre.example .k {
  color: var(--yellow);
  font-weight: 800;
}

pre.example .k::before {
  content: ":";
  color: var(--dim);
  margin-right: 2px;
}

pre.example .v {
  color: var(--pane-fg);
}

pre.example .warn {
  color: var(--orange);
  font-weight: 700;
}

pre.example .bad {
  color: var(--pink);
  font-weight: 800;
}

pre.example .muted {
  color: var(--muted);
}

/* ----------------------------------------------------------------------------
   Media
---------------------------------------------------------------------------- */

img {
  max-width: 100%;
  height: auto;
  display: block;

  margin: var(--media-margin-y) auto;
  padding: var(--media-pad);

  border: 1px solid var(--line);
  background: var(--block);
}

video {
  max-width: 100%;
  width: 100%;
  height: auto;
  max-height: var(--video-max-h);

  display: block;
  margin: var(--media-margin-y) auto;

  border: 1px solid var(--line);
  background: #000;
}

/* ----------------------------------------------------------------------------
   Postamble + modeline
---------------------------------------------------------------------------- */

#postamble .author,
#postamble .date,
#postamble .creator,
#postamble .validation {
  display: none !important;
}

#postamble {
  margin-top: auto;
  padding: 0;
  border: 0;
  background: transparent;
}

#modeline {
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);

  height: var(--modeline-h);
  display: flex;
  align-items: center;
  gap: var(--modeline-gap);

  padding: 0 calc(var(--padx) + env(safe-area-inset-left));

  background: var(--titlebar-seg-right);
  border-top: 1px solid var(--line);

  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;

  font-size: var(--modeline-font-size);
  font-weight: 500;
  letter-spacing: 0.02em;
  color: var(--muted);
}

#modeline .node {
  color: var(--muted);
  font-weight: 600;
}

#modeline .sep {
  color: var(--dim);
  margin: 0 8px;
}

#modeline .seg {
  display: inline-flex;
  align-items: baseline;
  gap: 6px;
}

#modeline .k {
  color: var(--yellow);
  font-weight: 800;
}

#modeline .v {
  color: var(--pane-fg);
  font-weight: 500;
}

#modeline .v.warn {
  color: var(--orange);
  font-weight: 700;
}

#modeline .v.bad {
  color: var(--pink);
  font-weight: 800;
}

/* ----------------------------------------------------------------------------
   Interactive tokens
---------------------------------------------------------------------------- */

.slab-token--interactive {
  color: var(--green);
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  font-weight: 500;
  white-space: nowrap;
}

.slab-token--interactive:hover {
  opacity: 0.85;
}

.slab-token--interactive:active {
  opacity: 0.65;
}
