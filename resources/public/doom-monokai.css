/* CONTRACT: doom-monokai.css
   Purpose:
   - Org HTML export provides structure.
   - CSS provides chrome, typography, and pane presentation.
   - JS compositor injects minimal chrome + modeline content.
   Non-goals:
   - Do not depend on Org's default inline CSS.
   - Avoid duplicate/overlapping selectors.
*/

/* ----------------------------------------------------------------------------
   Fonts
---------------------------------------------------------------------------- */

@font-face {
  font-family: "MonoLisaSkav";
  src: url("fonts/MonoLisaMonoLisaSkav-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "MonoLisaSkav";
  src: url("fonts/MonoLisaMonoLisaSkav-RegularItalic.ttf") format("truetype");
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

/* ----------------------------------------------------------------------------
   Theme variables
---------------------------------------------------------------------------- */

:root {
  --bg: #1c1e1f;
  --block: #202020;
  --line: #2d2e2e;

  --fg: #e8e3d6;
  --pane-fg: #f2efe6;

  --muted: #b7b1a1;
  --dim: #807a6a;

  --green:  #a6e22e;
  --cyan:   #66d9ef;
  --orange: #fd971f;
  --pink:   #f92672;
  --yellow: #e6b450;

  --font: "MonoLisaSkav", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "DejaVu Sans Mono", monospace;

  --padx: 1.9rem;

  --topbar-h: 72px;
  --workbar-h: 44px;

  --content-gap-top: 22px;
  --section-gap: 26px;

  /* Header glow knobs */
  --hdr-green: #a6e22e;
  --hdr-amber: #fd971f;
  --hdr-ice:   #a8d8ff;
  --hdr-white: #e8e3d6;

  --hdr-color: var(--hdr-amber);
  --hdr-weight: 600;

  --hdr-glow-a: 0.55;
  --hdr-glow-b: 0.25;

  --cursor-glow-a: 0.65;
  --cursor-glow-b: 0.25;
}

/* Prevent initial hue flash: pick from html attribute */
html[data-hdr-hue="amber"] { --hdr-color: var(--hdr-amber); }
html[data-hdr-hue="green"] { --hdr-color: var(--hdr-green); }
html[data-hdr-hue="ice"]   { --hdr-color: var(--hdr-ice); }
html[data-hdr-hue="white"] { --hdr-color: var(--hdr-white); }

/* ----------------------------------------------------------------------------
   Base layout + accessibility
---------------------------------------------------------------------------- */

* {
  box-sizing: border-box;
  scrollbar-width: none;          /* Firefox */
  -ms-overflow-style: none;       /* old IE/Edge */
  -webkit-tap-highlight-color: transparent;
}

*::-webkit-scrollbar {
  width: 0 !important;
  height: 0 !important;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg) !important;
  color: var(--fg) !important;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;

  font-family: var(--font);
  font-variant-ligatures: none;
  text-rendering: optimizeLegibility;
  letter-spacing: 0.2px;
  line-height: 1.45;

  padding-top: calc(var(--topbar-h) + var(--workbar-h) + var(--content-gap-top));
  padding-left: var(--padx);
  padding-right: var(--padx);
}

@supports (padding: env(safe-area-inset-left)) {
  body {
    padding-left: calc(var(--padx) + env(safe-area-inset-left));
    padding-right: calc(var(--padx) + env(safe-area-inset-right));
    padding-top: calc(
      var(--topbar-h) + var(--workbar-h) + var(--content-gap-top) + env(safe-area-inset-top)
    );
  }
}

::selection {
  background: rgba(166, 226, 46, 0.22);
}

/* Org TOC is not part of Consol surface */
#table-of-contents,
.toc,
.org-ul.toc {
  display: none !important;
}

/* ----------------------------------------------------------------------------
   Links
---------------------------------------------------------------------------- */

a {
  color: rgba(102, 217, 239, 0.85);
  text-decoration: none;
}

a:hover {
  color: var(--green);
}


/* ----------------------------------------------------------------------------
   CHROME: TITLEBAR
   - Left segment with dim wedge
   - Thin chevron centered inside wedge (blinks) ON TOP of wedge
   - Right segment with dim grey wedge
---------------------------------------------------------------------------- */

h1.title{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 200;

  margin: 0;
  padding: 0;

  display: flex;
  justify-content: space-between;
  align-items: stretch;

  background: #141517;
  border-bottom: 1px solid var(--line);

  font-size: 20px;
  font-weight: var(--hdr-weight);
  text-transform: lowercase;

  color: var(--fg);
}

h1.title .title-left-group{
  display: inline-flex;
  align-items: stretch;
}

h1.title .title-left,
h1.title .title-right{
  position: relative;
  display: inline-flex;
  align-items: center;

  height: 44px;
  padding: 0 18px;
}

/* --------------------------------------------------------------------------
   LEFT SEGMENT
-------------------------------------------------------------------------- */

h1.title .title-left{
  background: color-mix(in srgb, var(--hdr-color) 18%, #000);
  color: var(--hdr-color);
  border-left: 4px solid var(--hdr-color);
}

h1.title .title-text{
  white-space: nowrap;
}

/* Dim filled wedge (always visible) */
h1.title .title-left::after{
  content: "";
  position: absolute;
  top: 0;
  right: -22px;

  width: 0;
  height: 0;

  border-top: 22px solid transparent;
  border-bottom: 22px solid transparent;
  border-left: 22px solid color-mix(in srgb, var(--hdr-color) 18%, #000);

  z-index: 1; /* base layer */
}

/* Chevron outline centered inside wedge (ON TOP, blinks) */
h1.title .title-left::before{
  content: "";
  position: absolute;

  top: 50%;
  right: -15px;

  width: 14px;
  height: 14px;

  border-top: 3px solid var(--hdr-color);
  border-right: 3px solid var(--hdr-color);

  transform: translateY(-50%) rotate(45deg);

  z-index: 2; /* above wedge */
  animation: consol-chevron-blink 1.1s step-end infinite;
}

/* Blink toggles only chevron visibility */
@keyframes consol-chevron-blink{
  0%, 45% { opacity: 1; }
  46%, 100% { opacity: 0; }
}

/* --------------------------------------------------------------------------
   RIGHT SEGMENT
-------------------------------------------------------------------------- */

h1.title .title-right{
  background: #181a1c;
  color: color-mix(in srgb, var(--hdr-color) 70%, var(--fg));
}

/* Dim grey wedge (always visible) */
h1.title .title-right::before{
  content: "";
  position: absolute;
  top: 0;
  left: -22px;

  width: 0;
  height: 0;

  border-top: 22px solid transparent;
  border-bottom: 22px solid transparent;
  border-right: 22px solid #181a1c;
}
/* ----------------------------------------------------------------------------
   Chrome: Workspace strip (tabs)
   Supports:
   - old pages: #content > h1.title + p
   - injected:  #content > p.slab-tabs  (legacy class retained)
---------------------------------------------------------------------------- */

#content > h1.title + p,
#content > p.slab-tabs {
  position: fixed;
  top: var(--topbar-h);
  left: 0;
  right: 0;
  z-index: 190;

  margin: 0;
  height: var(--workbar-h);

  display: flex;
  align-items: center;

  padding: 0 calc(var(--padx) + env(safe-area-inset-left));

  background: #181a1c;
  border-bottom: 1px solid var(--line);

  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;

  font-size: 15px;
}

#content > h1.title + p a,
#content > p.slab-tabs a {
  display: inline-block;
  padding: 6px 10px;
  margin-right: 6px;

  color: var(--muted);
  border-bottom: 2px solid transparent;
}

#content > h1.title + p a:hover,
#content > h1.title + p a.active,
#content > p.slab-tabs a:hover,
#content > p.slab-tabs a.active {
  color: var(--fg);
  border-bottom-color: var(--orange);
}

/* ----------------------------------------------------------------------------
   Content structure
---------------------------------------------------------------------------- */

/* Key: body is a column so #postamble can sit at bottom on short pages */
#content {
  flex: 1 1 auto;
}

/* Section headers */
h2 {
  margin: var(--section-gap) 0 10px 0;
  padding: 10px 12px;

  background: rgba(15, 18, 22, 0.35);
  border: 1px solid var(--line);
  border-left: 4px solid var(--orange);

  color: var(--orange);
  font-size: 18px;
  font-weight: 800;
  letter-spacing: 0.09em;
  text-transform: uppercase;
}

/* Paragraphs */
p {
  margin: 12px 0;
  color: var(--fg);
}

/* Lists */
ul {
  list-style: none;
  padding-left: 0;
  margin: 12px 0 18px 0;
}

ul li {
  position: relative;
  padding-left: 18px;
  margin: 6px 0;
  color: var(--fg);
}

ul li::before {
  content: "•";
  position: absolute;
  left: 0;
  top: 0;
  color: var(--yellow);
  font-weight: 700;
}

/* ----------------------------------------------------------------------------
   Panes / examples / preformatted
---------------------------------------------------------------------------- */

.example,
pre,
pre.example {
  background: var(--block);
  border: 1px solid var(--line);
  margin: 12px 0 26px 0;

  overflow: hidden;

  font-family: var(--font);
  font-size: 14px;
  line-height: 1.5;
  color: var(--pane-fg);
}

.example {
  padding: 14px 16px;
}

pre.example {
  padding: 0;
}

/* Pane accent bars */
.example.pane-kv,    pre.example.pane-kv    { box-shadow: inset 0 2px 0 rgba(249, 38, 114, 0.55); }
.example.pane-art,   pre.example.pane-art   { box-shadow: inset 0 2px 0 rgba(102, 217, 239, 0.45); }
.example.pane-warn,  pre.example.pane-warn  { box-shadow: inset 0 2px 0 rgba(253, 151, 31, 0.60); }
.example.pane-media, pre.example.pane-media { box-shadow: inset 0 2px 0 rgba(230, 180, 80, 0.60); }
.example.pane-note,  pre.example.pane-note  { box-shadow: inset 0 2px 0 rgba(128, 122, 106, 0.55); }

pre.example .kv {
  display: grid;
  grid-template-columns: 112px 1fr;
  gap: 8px 14px;
  padding: 14px 16px;
}

pre.example .row { display: contents; }

pre.example .k {
  color: var(--yellow);
  font-weight: 800;
}

pre.example .k::before {
  content: ":";
  color: var(--dim);
  margin-right: 2px;
}

pre.example .v {
  color: var(--pane-fg);
}

pre.example .warn {
  color: var(--orange);
  font-weight: 700;
}

pre.example .bad {
  color: var(--pink);
  font-weight: 800;
}

pre.example .muted {
  color: var(--muted);
}

/* ----------------------------------------------------------------------------
   Media
---------------------------------------------------------------------------- */

img {
  max-width: 100%;
  height: auto;
  display: block;

  margin: 16px auto;
  padding: 6px;

  border: 1px solid var(--line);
  background: var(--block);
}

video {
  max-width: 100%;
  width: 100%;
  height: auto;
  max-height: 50vh;

  display: block;
  margin: 16px auto;

  border: 1px solid var(--line);
  background: #000;
}

/* ----------------------------------------------------------------------------
   Postamble + modeline
---------------------------------------------------------------------------- */

/* Hide Org’s default postamble junk */
#postamble .author,
#postamble .date,
#postamble .creator,
#postamble .validation {
  display: none !important;
}

/* Reset postamble container */
#postamble {
  margin-top: auto;
  padding: 0;
  border: 0;
  background: transparent;
}

/* The compositor injects #modeline into #postamble */
#modeline {
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);

  height: 44px;
  display: flex;
  align-items: center;
  gap: 10px;

  padding: 0 calc(var(--padx) + env(safe-area-inset-left));

  background: #181a1c;
  border-top: 1px solid var(--line);

  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;

  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.02em;
  color: var(--muted);
}

/* Modeline segments */
#modeline .node {
  color: var(--muted);
  font-weight: 600;
}

#modeline .sep {
  color: var(--dim);
  margin: 0 8px;
}

#modeline .seg {
  display: inline-flex;
  align-items: baseline;
  gap: 6px;
}

#modeline .k {
  color: var(--yellow);
  font-weight: 800;
}

#modeline .v {
  color: var(--pane-fg);
  font-weight: 500;
}

#modeline .v.warn {
  color: var(--orange);
  font-weight: 700;
}

#modeline .v.bad {
  color: var(--pink);
  font-weight: 800;
}

/* ----------------------------------------------------------------------------
   Interactive tokens
---------------------------------------------------------------------------- */

.slab-token--interactive {
  color: var(--green);
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  font-weight: 500;
  white-space: nowrap;
}

.slab-token--interactive:hover {
  opacity: 0.85;
}

.slab-token--interactive:active {
  opacity: 0.65;
}
