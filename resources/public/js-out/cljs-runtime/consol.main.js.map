{"version":3,"sources":["consol/main.cljs"],"mappings":"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","names":["consol.main/classify-value","v","consol.panes/classify-value","consol.main/state-val","st","k","fallback","cljs.core._EQ_","consol.main/mk-el","tag","class-name","e","js/document","consol.main/mk-span","cls","txt","el","consol.main/clear-children!","consol.main/append!","parent","child","consol.main/mk-seg","seg","k-el","v-el","klass","cljs.core/seq","consol.main/render-modeline!","temp__5823__auto__","m","consol.chrome/ensure-modeline!","nrepl","http","time","battery","volume","sep","seq__8948","chunk__8949","count__8950","i__8951","cljs.core/chunked-seq?","c__5673__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","x","consol.main/tick!","consol.chrome/ensure-chrome!","consol.chrome/highlight-active-tab!","consol.theme/fetch-theme!","consol.panes/mount-all-panes!","consol.state/fetch-state!","s","consol.panes/render-panes!","js/consol","js/consol.main","js/consol.main.started?","consol.main/started?","cljs.core.atom","consol.main/start!","cljs.core/deref","cljs.core/reset!","consol.events/attach!","consol.tokens/hydrate-interactive-tokens!","consol.config/fetch-tabs!","_","js/setInterval","consol.config/poll-ms","js/console.log","consol.main/init!"],"sourcesContent":[";; src-cljs/consol/main.cljs\n(ns consol.main\n  (:require [consol.events :as events]   ;; interactive tokens (run-token)\n            [consol.config :as cfg]\n            [consol.chrome :as chrome]\n            [consol.panes :as panes]\n            [consol.tokens :as tokens]\n            [consol.theme :as theme]\n            [consol.state :as state]))\n\n;; ------------------------------------------------------------\n;; Modeline rendering (kept here for now)\n;; ------------------------------------------------------------\n\n(defn- classify-value [v]\n  (panes/classify-value v))\n\n(defn- state-val [st k fallback]\n  (let [v (when st (aget st k))]\n    (if (or (nil? v) (undefined? v) (= \"\" (str v)))\n      fallback\n      (str v))))\n\n(defn- mk-el [tag class-name]\n  (let [e (.createElement js/document tag)]\n    (set! (.-className e) class-name)\n    e))\n\n(defn- mk-span [cls txt]\n  (let [el (.createElement js/document \"span\")]\n    (set! (.-className el) cls)\n    (set! (.-textContent el) (str txt))\n    el))\n\n(defn- clear-children! [el]\n  (set! (.-innerHTML el) \"\")\n  el)\n\n(defn- append! [parent child]\n  (.appendChild parent child)\n  parent)\n\n(defn- mk-seg [k v]\n  (let [seg (mk-el \"span\" \"seg\")\n        k-el (mk-span \"k\" k)\n        v-el (mk-span \"v\" v)\n        klass (classify-value v)]\n    (when (seq klass)\n      (.. v-el -classList (add klass)))\n    (append! seg k-el)\n    (append! seg v-el)\n    seg))\n\n(defn render-modeline! [st]\n  (when-let [m (chrome/ensure-modeline!)]\n    (clear-children! m)\n    (let [nrepl   (state-val st \"nrepl\" \"\u2014\")\n          http    (state-val st \"http\" \"\u2014\")\n          time    (state-val st \"time\" \"\u2014\")\n          battery (state-val st \"battery\" \"\u2014\")\n          volume  (state-val st \"volume\" \"\u2014\")\n          sep     (fn [] (mk-span \"sep\" \"\u00b7\"))]\n      (append! m (mk-span \"node\" \"consol\"))\n      (doseq [x [(sep) (mk-seg \":nrepl\" nrepl)\n                 (sep) (mk-seg \":http\" http)\n                 (sep) (mk-seg \":time\" time)\n                 (sep) (mk-seg \":battery\" battery)\n                 (sep) (mk-seg \":volume\" volume)]]\n        (append! m x))))\n  nil)\n\n;; ------------------------------------------------------------\n;; Tick/init\n;; ------------------------------------------------------------\n\n(defn tick! []\n  (chrome/ensure-chrome!)\n  (chrome/highlight-active-tab!)\n  (theme/fetch-theme!)\n  (panes/mount-all-panes!)\n  (-> (state/fetch-state!)\n      (.then (fn [s]\n               (when s (panes/render-panes! s))\n               (render-modeline! s)))))\n\n(defonce ^:private started? (atom false))\n\n(defn start! []\n  (when-not @started?\n    (reset! started? true)\n\n    ;; interactive token clicks\n    (events/attach!)\n\n    ;; build clickable {{name*}} tokens + slots\n    (tokens/hydrate-interactive-tokens!)\n\n    ;; tabs.edn once\n    (-> (cfg/fetch-tabs!)\n        (.then (fn [_]\n                 (chrome/ensure-chrome!)\n                 (chrome/highlight-active-tab!))))\n\n    (tick!)\n    (js/setInterval tick! cfg/poll-ms)\n\n    (js/console.log \"consol client online (full)\")))\n\n(defn init! []\n  ;; Delay until <body> exists.\n  (if (.-body js/document)\n    (start!)\n    (.addEventListener js/document \"DOMContentLoaded\" start!)))\n\n(init!)\n"]}